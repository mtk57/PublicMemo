
■VB.NET  Application.DoEventsについて

＜問題点＞   ※参考：http://dotnetrevo.blog21.fc2.com/blog-entry-2.html
    UIスレッド上で、あるボタンのクリックにて、少し時間のかかる処理が呼び出され、定期的にApplication.DoEventsを行うという場合を考えよう。
    DoEventsが呼び出されたとき、どんなことが行われるのだろうか？
    ----------
    ①UIスレッド上での処理はApplication.DoEventsのメソッドの部分で一旦停止する。
    ②ボタンクリックから、①までの間にキューに貯まったWindowsメッセージが処理される。
    ③キューに貯まっていたすべてのWindowsメッセージが処理されたあと、①の続きの処理が実行される。
    ----------
    ここで問題になるのは、②で処理されるWindowsメッセージの内容である。
    ②に含まれているのは、時間のかかる処理が行われる間に、ユーザがほかのボタンを押したり、キーボードを押したイベントの処理がある。
    また、マルチスレッドアプリケーションであれば、UIスレッドへのマーシャリングで待機状態となっていた処理が含まれる。
    ということは、UIスレッド上に割り込ませたいWindowsメッセージ以外のWindowsメッセージが割り込む可能性があるということである。
    割り込んだWindowsメッセージの処理が、ただ進捗状態を表示するだけのようなものであればよいが、
    もしそこから別の時間のかかる処理や、別のスレッドを呼び出すようなものだったらどうだろうか？
    ①の処理を呼び出したユーザの意図とは異なる動作が実行されることになる。
    さらに、もしプログラム上で排他ロックなどを使用していれば、デッドロックが発生することもある。


基本的には使用しないのがベスト


＜代替策＞

Backgroundworkerがいいと思う。


